<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width" />
  <title>Next-gen Kaldi WebAssembly with sherpa-ncnn for ASR</title>
  <script src="sherpa-ncnn-wasm-main.js"></script>
  <script src="sherpa-ncnn.js"></script>
</head>

<body>
  <button onclick="myFunction()">Click Me!</button>
  <button onclick="myFunction2()">Test!</button>
  <button onclick="myFunction3()">Read!</button>
  <button onclick="myFunction4()">String!</button>

  <script>
    function myFunction() {
      console.log("Button clicked!")
      _RunSherpaNcnn()
    }

    function myFunction2() {
      let array = [1, 2, 3, 4, 5];
      let typedArray = new Float32Array(array);
      let pointer = Module._malloc(
        typedArray.length * typedArray.BYTES_PER_ELEMENT
      );
      Module.HEAPF32.set(typedArray, pointer/typedArray.BYTES_PER_ELEMENT);
      Module.ccall(
        "MyTest",
        null,
        ["number", "number"],
        [pointer, typedArray.length]
      );
      Module._free(pointer);
    }

    function myFunction3() {
      let pointer = Module._malloc(4);
      let a = Module.ccall(
        "ReadData",
        "number",
        ["number"],
        [pointer]
      );
      var n = new Int32Array(Module.HEAP32.buffer, pointer, 1);
      console.log(n[0])

    }

    function myFunction4() {
      let modelConfigObj = {
        encoderParam: "./encoder.ncnn.param",
        encoderBin: "./encoder.ncnn.bin",
        decoderParam: "./decoder.ncnn.param",
        decoderBin: "./decoder.ncnn.bin",
        joinerParam: "./joiner.ncnn.param",
        joinerBin: "./joiner.ncnn.bin",
        tokens: "./tokens.txt",
        useVulkanCompute: 0,
        numThreads: 1,
      }
      let modelConfig = initSherpaNcnnModelConfig(modelConfigObj, Module)

      let decoderConfigObj = {
        decodingMethod: "greedy_search",
        numActivePaths: 4,
      }
      let decoderConfig = initSherpaNcnnDecoderConfig(decoderConfigObj, Module)

      let featConfigObj = {
        samplingRate: 16000,
        featureDim: 80,
      }
      let featConfig = initSherpaNcnnFeatureExtractorConfig(featConfigObj, Module)

      _MyTest2(modelConfig.ptr, decoderConfig.ptr, featConfig.ptr);


      freeConfig(modelConfig, Module)
      freeConfig(decoderConfig, Module)
      freeConfig(featConfig, Module)


    }
  </script>
</body>
